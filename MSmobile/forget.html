<!DOCTYPE html>
<html lang="en">
<head lang="en">
    <meta charset="UTF-8">
    <title>MSO-眸事网，国内专业营销服务外包平台</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no"
          id="viewport">
    <meta name="description"
          content="MSO（眸事网）-国内专业营销服务外包平台，获客线索总交易量高达632500条！上游发包方企业可自由定价，行业包括线上/线下教育培训行业、金融行业、汽车行业、汽车后服务市场、电商平台、运营商增值服务等领域，下游以网络营销、电话营销、地推机构等营销机构为主，平台坐拥10000万以上精准数据用户，月均发包量达80000以上，目前已成为各领域权威人士认可的最专业的营销服务外包机构！">

    <script src="js/jquery-1.7.2.min.js" type="text/javascript"></script>
    <!--<script src="../public/easing.js" type="text/javascript"></script>-->
    <!--<script src="../public/react.min.js"></script>-->
    <!--<script src="https://www.mshuoke.com/html/js/url.js"></script>-->
    <script src="js/count.js"></script>
    <script src="js/des.js"></script>
	<script src="public/url.js"></script>
    <!-- <script src="https://www.mshuoke.com/html/js/home_index/des.js"></script> -->
    <style>
        body, button, dd, div, dl, dt, fieldset, form, h1, h2, h3, h4, h5, h6, img, input, li, ol, p, table, td, ul {
            margin: 0;
            padding: 0;
            -webkit-box-sizing: border-box;
            -moz-box-sizing: border-box;
            box-sizing: border-box;
        }

        body {
            background-color: #F4F4F4;

        }

        .body {
            /*min-height: 611px;*/
            width: 90%;
            margin: 0 auto;
        }

        .clear::before, .clear::after {
            display: block;
            clear: both;
            content: '';
            zoom: 1;
        }

        .logo {
            width: 100%;
            height: 100px;
            background: url("images/login/Mlogo.png") no-repeat center;
        }

        .telNum > input, .password > input {
            width: 100%;
            height: 51px;

        }

        .telNum, .password, .checkNum {
            position: relative;
        }

        .telNum > img, .password > img, .checkNum > img {
            display: none;
            position: absolute;
            top: 50%;
            margin-top: -8px;
            right: 3%;

        }

        .checkNum > img {
           right: 124px;
        }

        input {
            font-size: 14px;
            padding-left: 3%;
            background-color: #fff;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            border: 1px solid #DDDDDD;
            outline-color: #3B48EE;

        }

        input::placeholder {
            font-family: PingFangSC-Regular;
            font-size: 14px;
            color: #DDDDDD;
        }

        .checkNum {
            margin: 20px 0;
        }

        .checkNum > input {
            width: 100%;
            padding-right: 120px;
            height: 51px;
            float: left;

        }

        button {
            border: none;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            text-align: center;
            color: #FFFFFF;
            font-family: PingFangSC-Regular;
            font-size: 16px;
            outline: none;
            
        }

        .checkNum > button {
            position: absolute;
            top: 0;
            right: 0;
            width: 120px;
            float: left;
            height: 51px;
            background-color: #3B48EE;
        }

        .modify {
            width: 100%;
            height: 50px;
            text-align: center;
            background-color: #3B48EE;
            -webkit-border-radius: 4px;
            -moz-border-radius: 4px;
            border-radius: 4px;
            opacity: 0.6;
            box-shadow: 0 3px 6px 0;
            font-family: PingFangSC-Regular;
            font-size: 16px;
            color: #FFFFFF;
            margin: 30px 0 20px 0;
        }

        .login {
            text-align: center;
        }

        .login > a {
            font-family: PingFangSC-Regular;
            font-size: 14px;
            color: #666666;
            border: none;
        }

        footer {
            padding-top: 9px;
            background-color: #D0D0D0;
            font-size: 12px;
            height: 52px;
            width: 100%;
            color: #FFFFFF;
            text-align: center;
            position: absolute;
            bottom: 0;
        }

        p.err {
            padding-left: 2px;
            position: absolute;
            bottom: -18px;
            color: red;
            font-size: 12px;
        }

        #disable {
            color: #FFFFFF;
            font-size: 16px;
            font-family: PingFangSC-Regular;
            background-color: #DDDDDD;
            outline: none;
        }

        header {
            background: linear-gradient(to bottom, #5E12CE, #3B48EE);
            color: #FFFFFF;
            width: 100%;
            height: 64px;
            line-height: 64px;
            font-size: 16px;
            position: relative;
            text-align: center;
        }

        .back {
            position: absolute;
            left: 10px;
        }

        .back:after {
            content: " ";
            display: inline-block;
            height: 10px;
            width: 10px;
            border-width: 2px 2px 0 0;
            border-color: #FFFFFF;
            border-style: solid;
            -webkit-transform: matrix(-0.71, -0.71, 0.71, -0.71, 0, 0);
            transform: matrix(-0.71, -0.71, 0.71, -0.71, 0, 0);
        }
    </style>
</head>
<!-- <script src="https://code.jquery.com/jquery-1.11.3.js"></script> -->
<body>
<header><a class="back" href="javascript:history.go(-1)"> </a>眸事网</header>
<div class="body">
    <div class="logo"></div>
    <div class="telNum">
        <input type="text" placeholder="请输入您的手机号">
        <img src="images/login/btn-x.png" alt="">
        <p class="err"></p>
    </div>
    <div class="checkNum clear">
        <input type="text" placeholder="请输入验证码">
        <button>获取验证码</button>
        <img src="images/login/btn-x.png" alt="">
        <p class="err"></p>
    </div>
    <div class="password"><input type="password" placeholder="请输入6〜16位数字或字母组成的密码">
        <img src="images/login/btn-x.png" alt="">
        <p class="err"></p>
    </div>
    <button class="modify">确认修改密码</button>
    <div class="login">
        <a href="./login.html">已有账号？&nbsp;立即登录</a>
    </div>
</div>
<footer>
    <p>
        Copyright © 2011-2017 上海脉豪商务信息咨询有限公司
    </p>
    <p>
        版权所有 沪ICP备15029022号
    </p>
</footer>
</body>
<script>
   $(function () {
        var getNum, now;
        $("input").on("input", function () {
            if($(".telNum>input").val().trim()==""||$(".checkNum>input").val().trim()==""||$(".password>input").val().trim()==""){
                $(".modify").css("opacity",0.6)
            }else{
                $(".modify").css("opacity",1)
            }

            var pName = $(this).parent().attr("class")
            var content = "";
            if (pName == "telNum") {
                content = ""
            } else if (pName == "password") {
                content = ""
            } else {
                content = ""
            }
            if ($(this).val().trim().length > 0) {
                $(this).siblings("img").show().siblings(".err").html("")
            } else {
                $(this).siblings("img").hide().siblings(".err").html(content)
            }

        })
        $("img").on("click", function () {
            $(this).hide().siblings("input").val("");
            $(".modify").css("opacity","0.6");
            $(".err").html("")
        })

        now = sessionStorage.getItem("nowTimeF")
        if (now) {
            countDown()
        }

        function countDown() {
            $(".checkNum>button").attr("id", "disable").html("90秒后重新获取")
            clearInterval(getNum);
            getNum = setInterval(function () {
                var dis = parseInt((new Date().getTime() - now) / 1000)
                $(".checkNum>button").html(90 - dis + "秒后重新获取");
                if (dis > 90) {
                    clearInterval(getNum)
                    sessionStorage.removeItem("nowTimeF")
                    $(".checkNum>button").attr("id", "").html("获取验证码")
                }
            }, 1000)
        }

        /**
         * 获取验证码
         */
        $(".checkNum>button").on("click", function () {
            if ($(".checkNum>button").attr("id") == "disable") {
                return;
            }
            var telNum = $(".telNum>input").val().trim();
            if (!telNum) {
                $(".telNum>.err").html("手机号不能为空");
                return;
            } else {
                if (!/^1(3|4|5|7|8)\d{9}$/.test(telNum)) {
                    $(".telNum>.err").html("手机号格式不正确");
                    return;
                } else {
                    $(".telNum>.err").html("")

                }
            }
            now = new Date().getTime();//获取当前时间，存到session
            sessionStorage.setItem("nowTimeF", now);
            countDown()
            $.ajax({
                url: "https://www.mshuoke.com/user/telCode",
                type: "post",
                data: {
                    type: 2,//用户类型
                    jfuname: strEnc(telNum, "m", "s", "o"),//用户名/ 对应 2.0版本的手机号
                },
                success: function (result) {
                    if (result.code == "Y") {
                        //号码注册过之后合法开始倒计时

                        //TODO 获取验证码后是否将验证码和对应的手机号存入session
                        sessionStorage.setItem("smsCode",result.smsCode)
                        sessionStorage.setItem("telNumSend",telNum)
                    } else {

                         if(result.code=="ER0013"){
                            $(".checkNum>.err").html("用户名或者手机号码不能为空");
                        }else if(result.code=="ER0011"){
                            $(".checkNum>.err").html("您输入的用户名或手机号码格式不对");

                        }else if(result.code=="ER002"){
                            $(".checkNum>.err").html("用户名或者手机号已经被占用");

                        }else if(result.code=="ER003"){
                            $(".checkNum>.err").html("您输入的用户名不存在");

                        }else if(result.code=="ER0028"){
                            $(".checkNum>.err").html("短信发送失败");

                        }else{
                            $(".checkNum>.err").html("网络失败，请重新获取");
                        }

                        clearInterval(getNum)
                    
                        
                    
                    }
                },
                error: function (msg) {
                    $(".checkNum>.err").html("获取失败，请重新获取");
                    console.log(msg);
                }
            })
        })

        /**
         * 重置密码
         */
        $(".modify").on("click", function () {
            if($(".modify").css("opacity")==0.6){
                return ;
            }
            var telNum = $(".telNum>input").val().trim();
            var checkNum = $(".checkNum>input").val().trim();
            var password = $(".password>input").val().trim();


            //手机号验证
            if (!telNum.length) {
                $(".telNum>.err").html("手机号不能为空")
                return;
            } else {
                if (!/^1(3|4|5|7|8)\d{9}$/.test(telNum)) {
                    $(".telNum>.err").html("手机号格式不正确");
                    return;
                } else {
                    $(".telNum>.err").html("")

                }
            }
            //验证码为空验证
            if (!checkNum.length) {
                $(".checkNum>.err").html("验证码不能为空")
                return;
            } else {
                $(".checkNum>.err").html("")
            }

            //验证码与注册手机号是否匹配验证
            if(telNum!=sessionStorage.getItem("telNumSend")||checkNum!=sessionStorage.getItem("smsCode")){
                $(".checkNum>.err").html("验证码不正确,请重新获取")
                return;
            }
            //密码格式与长度验证
            if (!password.length) {
                $(".password>.err").html("密码不能为空");
                return;
            } else {
                if (password.length > 16 || password.length < 6) {
                    $(".password>.err").html("密码长度不符合")
                    return;
                } else {
                    if (!new RegExp(/^[0-9A-Za-z]+$/).test(password)) {
                        $(".password>.err").html("密码格式不正确")
                        return;
                    } else {
                        $(".password>.err").html("")
                    }
                }
            }

            $.ajax({
                url: "https://www.mshuoke.com/user/resetPassword",
                data: {username: telNum, password: password, type:2,smscode:sessionStorage.getItem("smsCode")},
                type: "post",
                success: function (result) {
                    if(result.code=="Y"){
                        sessionStorage.setItem("telNum",result.jfuname);
                        sessionStorage.removeItem("smscode")
                        sessionStorage.removeItem("telNumSend")
                        sessionStorage.removeItem("nowTimeF")
                        location.href="./index.html"
                    }else{
                        alert(result.msg)
                    }
                },
                error: function (err) {
                    // console.log(err);
                }
            })


        })


    })
</script>
</html>
