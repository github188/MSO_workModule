<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Bootstrap Table Examples</title>


	<link rel="stylesheet" href="../css/bootstrap.min.css" />
	<link rel="stylesheet" href="../css/bootstrap-table.css" />
	<link rel="stylesheet" href="../css/bootstrap-datetimepicker.css" />
	
	
	<script src="../js/jquery.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js"></script>

	<script src="../js/bootstrap-table.min.js" type="text/javascript"></script>
	<script src="../js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
	<script src="../js/url.js" type="text/javascript"></script>
	<script src="../js/mock.js" type="text/javascript"></script>
	<script src="../js/myself-function/main.js" type="text/javascript"></script>
	<script src="../js/PerfectData_upload-darren.js" type="text/javascript"></script>
	
	<style>
		#forlogin { display:none; background:#ffffff;  overflow:hidden; height:100%; }
		*{ padding:0; margin:0; }
		ul li { list-style-type:none; }
		#forlogin ul { width:100%; overflow:hidden; margin-top:20px;  }
		#forlogin ul li { float:left; width:50%; }
		
		#forlogin ul li.first {width:60px; text-align:right; }
		#forlogin ul.industry{ margin-top:30px; }
		#forlogin ul.industry li {  }
		#forlogin ul.industry li input { float:left;  }
		#forlogin ul.high li.high-n   { text-align:left;  }
		
		#forlogin ul li.last  { padding-left:20px;  }
		#forlogin ul li .running { float:left;  width:70px; height:20px; }
		#forlogin ul li .outOff { float:left; width:70px; height:20px; }
		#forlogin ul li .outOff  span { float:left; margin-top:2px; margin-left:5px;  display:inline-table; }
		#forlogin ul li .running  span { float:left; margin-top:2px;    margin-left:5px;   display:inline-table; }
		#forlogin ul li .outOff input { float:left; }
		#forlogin ul li .running input { float:left; }
		#forlogin ul.descening li input { float:left; }
		#addIndustry  { margin-top:20px; }
		#toolbar { width:120px; } 
		.industrySetting { width:100%; overflow:hidden; margin-top:20px; margin-bottom:0; }
		.industrySetting li { float:left; }
		.search-box { overflow-y:hidden; padding-bottom:3px; min-width:1200px; }
		
		
		.search-box  #toolbar {margin-left:20px; float:left; margin-top:10px; margin-bottom:10px; }
		
		
		
		@media (min-width: 100px) {
			.container {
				width: auto;
			}
		}
		
		
		
		.pull-right1 { float:left; }
		.pull-right1.select { width:127px; }
		.search-box { margin-top:10px; }

		
		.data-box {
			width: 330px;
			height: 30px;
			border-radius: 6px;
			border: 1px solid #e8e8e8;
			padding-bottom: 0;
			position: relative;
			float:left; 
			margin-top:2px;
		}
		
		.data-box input {
			color: #a7a7a7;
			width: 150px;
			border: none;
			text-align: center;
			line-height: 28px;
		}
		
		.search-btn { margin-left:20px; }
		th,td { text-align:center; }
		
		
		
		
		
		
		
		
		.modal-dialog { width:860px; }
.modal-body-title { margin-top:10px; border-bottom:1px solid #e5e5e5; padding-bottom:15px;  }
ul li { list-style:none; }
.main-title-box { overflow:hidden; }
.main-title { width:10px; height:20px; background:rgba(255, 153, 0, 1); display:block; float:left; }
.main-box { margin-top:20px; overflow:hidden;  }
.main-txt { margin-left:10px; }
.main-list-item { float:left; width:400px; }
.main-list-item li { line-height:38px; }
.main-list-item li span:nth-child(1){ font-weight:700; font-family: 'Arial Negreta', 'Arial';}
.btn-primary { background:#5cb85c; border-color:#4cae4c; }

.conpanyname { float:left; }

.main-list-item.conpany { margin-bottom:20px; }
.error.time { display:none; }
.modal-body-title.special { margin-top:30px; }
.modal-body-title.noborder { border-bottom:0; padding:0;}

 .btn-success.btn-lg { padding:6px 12px; }
.btn-lg, .btn-group-lg>.btn { font-size:14px; }
.pull-right1.search { margin-top:0; float:left; width:250px; }




.modal-body { max-height:500px; overflow-y:auto; }

.vestingtime  .data-box { width:160px; }
.vestingtime  .data-box { width:160px;  height:auto; }
.basicnot { display:none; }
.basicdetail { display:none; }
.basicmaked { display:none; }

.pull-right1.search {
    margin-top: 0;
    float: left;
    width: 317px;
}

.pull-right1.select {
    width: 127px;
    margin-left: 5px;
}


.bootstrap-table .fixed-table-toolbar {  overflow:-hidden; }
.pull-left.search { display:none; height:auto;}

.bootstrap-table { margin-top:-30px; }
.main-list-item li { width:100%; overflow:hidden; }
.main-list-item li span:nth-child(1) {
    float: left;
}

.msg-error.hy {
    color: red;
    font-size: 14px;
    font-weight: normal;
	display:none;
}


.pull-right1.select.idious { width:100%; }
.salepad.test { cursor:pointer;
		width:100px;
		height:30px; 
		color: #fff;
		background-color: #5cb85c;
		border-color: #4cae4c;
		text-align:center;
		line-height:30px;
		border-radius:5px;
	}

.salepad.test a { color:#ffffff; }
	</style>
</head>
<body>
    <div class="container">
		<div class="search-box">
			<div class="fixed-table-toolbar">
				<div class="pull-right1 search">
					<input class="form-control" type="text" placeholder="Search" >
				</div>
				
				
				<!--
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">选择业务类型</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">选择审核人</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				-->
				<div class="pull-right1 select">
					<select style="width:auto;" class="form-control BDstaff">
						<option value="1">选择BD专员</option>
						
					</select>
				</div>
				<!--
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">选择状态</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				<div class="data-box">
						<input autoComplete="off" placeholder="开始日期" type="text" class="form_date start_date" readOnly /><i class="date_icon"></i><span>~</span>
						<input autoComplete="off" placeholder="结束日期" type="text" class="form_date end_date" readOnly /><i class="date_icon"></i>
						<p class="error time">请填写开始日期</p><p class="error time">请填写结束日期</p>
				</div>
				<div class="data-box">
						<input autoComplete="off" placeholder="开始日期" type="text" class="form_date start_date" readOnly /><i class="date_icon"></i><span>~</span>
						<input autoComplete="off" placeholder="结束日期" type="text" class="form_date end_date" readOnly /><i class="date_icon"></i>
						<p class="error time">请填写开始日期</p><p class="error time">请填写结束日期</p>
				</div>
				-->
				<div class="pull-right1 select search-btn">
					<button type="button" class="btn btn-success">搜索</button>
				</div>
			</div>
		
    
		
		</div>
		
	    <table id="table">
            
        </table>
		
		 <div id="addIndustry">
			<!--<button   class="btn btn-primary  btn-success btn-lg getout">导出EXCEL</button>-->
			<button  class="btn btn-default btn-success  addone">新增</button>
			<button  class="btn btn-default cancel">后退</button>
		</div>
	
	<div id="forlogin">
		 <div>
			
			<ul class="high">
				<li  class="first" >分类级别:</li>
				<li class="high-n last">一级分类</li>
			</ul>
			<ul>
				<li  class="first" >状态:</li>
				<li class="last">
					<div class="running"><input type="radio" /><span>启用</span></div>
					<div class="outOff"><input type="radio" /><span>停用</span></div>
				</li>
			</ul>
			<ul class="descening">
				<li  class="first" >排序值</li>
				<li class="last"><input placeholder="请输入排序值，值越大越靠前"/></li>
			</ul>
		 </div>
	</div>
	 
	<!--<button id="addIndustry" class="btn btn-default">新增行业</button>--> 
	</div>
	
	
	
	
	<!--弹出成-->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					dba统计
				</h4>
			</div>
			
			
			
			<div class="modal-body">
				<div class="modal-body-title special noborder">
					<span class="main-title"></span>
					<span class="main-txt">基本信息：</span>
					<span class="main-txt demandid"></span>
				</div>
				<div class="main-box">
					
					<ul class="main-list-item">
						<li>
							<span>id：</span>
							<span class="reportid"></span>
						</li>
						<li>
							<span>需求名：</span>
							<span class="uniquename"></span>
						</li>
						<li>
							<span>需求量：</span>
							<span class="demandquantity"></span>
						</li>
						<li>
							<span style="width:72px;">统计时间：</span>
							<div style="float:left;" class="pull-right1 select">
								<input name="reporttime" readOnly="readOnly" class="start_date form-control reporttime valid" />
							</div>
							<p class="msg-error start_dateerror hy"></p>
						</li>
						<li>
							<span style="width:72px;">递交量：</span>
							
							<div style="float:left;" class="pull-right1 select">
								<input name="finishnum" class="form-control finishnum valid" type="number" />
							</div>
							<p class="msg-error finishnumerror hy"></p>
						</li>
						<li>
							<span>成单报告汇总：</span>
							<div style="float:left;" class="pull-right1 select idious">
								<a class="reporturl" href="javascript:;"></a>
								
								<div class="upload reporturl1 compimg">
										<span style="float:left;"></span>
										<form id="salepad" action="" enctype="">
											<div>
												<span style="display:none;">文件路径</span>
												<input style="display:none;" class="idkey" type="text" name="key" value="">
												<span style="display:none;">OSSAccessKeyId</span>
												<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="">
												<span style="display:none;">policy</span>
												<input style="display:none;" class="idpolicy" type="text" name="policy" value="">
												
												<input style="display:none;" class="status" type="text" name="success_action_status" value="200">
												

												<span style="display:none;">Signature</span>
												<input style="display:none;" class="idSignature" type="text" name="Signature" value="">
												
												<input style="display:none;" name="file" type="file" class="file">
											</div>
										</form>
										<div class="salepad test">点击上传</div>
										<div class="uploadname"></div>										
										<p class="msg-error hy"></p>	
												
								</div>
							</div>
						</li>
					</ul>
					
					
				</div>

				<!--
				<div class="main-box attachment">
					<ul class="main-list-item">
						<li>
							<span>销售线索模板：</span>
							<span class="saleleadsurl"><a href="javascript:;"></a></span>
						</li>
						<li>
							<span>话术文件：</span>
							<span class="speechcrafturl"><a href="javascript:;"></a></span>
						</li>
						<li>
							<span>目标客户名单：</span>
							<span class="targetcusturl"><a href="javascript:;"></a></span>
						</li>
						
					</ul>
				</div>
			    -->
	</div>
	
	
	
	
	
	

	
	
	
	<div class="modal-footer">
				<button type="button"  class="btn determine btn-primary"  >
					确认
				</button>
				<button type="button"  data-dismiss="modal"  class="btn btn-default" >
					取消
		</button>
		</div><!-- /.modal-content -->
</div>

</div>
</div>













	<!--弹出成2-->
	<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					dba统计
				</h4>
			</div>
			
			
			
			<div class="modal-body">
				<div class="modal-body-title special noborder">
					<span class="main-title"></span>
					<span class="main-txt">基本信息：</span>
					<span class="main-txt demandid"></span>
				</div>
				<div class="main-box">
					
					<ul class="main-list-item">
						<li>
							<span>id：</span>
							<span class="uniqid2"></span>
						</li>
						<li>
							<span>需求名：</span>
							<span class="uniquename2"></span>
						</li>
						<li>
							<span>需求量：</span>
							<span class="demandquantity2"></span>
						</li>
						<li>
							<span style="width:72px;">统计时间：</span>
							<div style="float:left;" class="pull-right1 select">
								<input name="reporttime2" readOnly="readOnly" class="start_date2 form-control reporttime2 valid" />
							</div>
							<p class="msg-error start_datetwoerror hy"></p>
						</li>
						<li>
							<span style="width:72px;">递交量：</span>
							
							<div style="float:left;" class="pull-right1 select">
								<input name="finishnum2" class="form-control finishnum2 valid" type="number" />
							</div>
						
							<p class="msg-error finishnumtwoerror hy"></p>
						</li>
						<li>
							<span>成单报告汇总：</span>
							<div style="float:left;" class="pull-right1 select idious">
								
								<div class="upload reporturl2 compimg">
										<span style="float:left;"></span>
										<form id="salepad" action="" enctype="">
											<div>
												<span style="display:none;">文件路径</span>
												<input style="display:none;" class="idkey" type="text" name="key" value="">
												<span style="display:none;">OSSAccessKeyId</span>
												<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="">
												<span style="display:none;">policy</span>
												<input style="display:none;" class="idpolicy" type="text" name="policy" value="">
												
												<input style="display:none;" class="status" type="text" name="success_action_status" value="200">
												

												<span style="display:none;">Signature</span>
												<input style="display:none;" class="idSignature" type="text" name="Signature" value="">
												
												<input style="display:none;" name="file" type="file" class="file">
											</div>
										</form>
										<div class="salepad test">点击上传</div>
										<div class="uploadname"></div>	
										<p class="msg-error reporturl2error hy"></p>	
												
								</div>
							</div>
						</li>
					</ul>
					
					
				</div>

				<!--
				<div class="main-box attachment">
					<ul class="main-list-item">
						<li>
							<span>销售线索模板：</span>
							<span class="saleleadsurl"><a href="javascript:;"></a></span>
						</li>
						<li>
							<span>话术文件：</span>
							<span class="speechcrafturl"><a href="javascript:;"></a></span>
						</li>
						<li>
							<span>目标客户名单：</span>
							<span class="targetcusturl"><a href="javascript:;"></a></span>
						</li>
						
					</ul>
				</div>
			    -->
	</div>
	
	
	
	
	
	

	
	
	
	<div class="modal-footer">
				<button type="button"  class="btn determine2 btn-primary"  >
					确认
				</button>
				<button type="button"  data-dismiss="modal"  class="btn btn-default" >
					取消
		</button>
		</div><!-- /.modal-content -->
</div>

</div>
</div>














<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static'>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">提示</h4>
      </div>
      <div class="modal-body">
        请稍候。。。
      </div>
    </div>
  </div>
</div>




<script>
/*新增行业*/
	
	
	
	var $table = $('#table');
	//https://gateway.mshuoke.com/quality/secondreport?pid=20170228054353463
	var domin = 'https://gateway.mshuoke.com/quality/';
	var url = domin+'secondreport';
	var requiredata = JSON.parse($.decode($.sessionStorage('requiredata')));
	
	
	$table.bootstrapTable({
		 url:url,
		 pagination: true, //分页
		 contentType:'application/json',
		 search:true,
		 showFooter:true,
		 showColumns:true,
		 searchAlign:'left',
		 checkbox:false,
		 queryParams:function (params){
		   params.pid = requiredata.id;  
		  // params.pid = '20170808110223627';  
		   return  params;
		 },
		 sidePagination: "client",
		 responseHandler:function(res){
			var newJson = {};
			newJson.total = res.data.length;
			//同步数据
			res.data.map(function (data,index){
				data.conpanyname = requiredata.companyname;
				data.demandname = requiredata.demandname;
				data.demandquantity = requiredata.demandquantity;
				data.uniquename = requiredata.uniquename;
			});
			newJson.data = res.data;

			return newJson;
		 },
		 onLoadSuccess(){
			/*移动自带事件*/
			$('.search-btn button').click(function(){
				$('.search input').eq(1).val($('.search input').eq(0).val());
				$('.search input').eq(1).keyup();
			});
			
			
			$('.search input').eq(0)[0].oninput= function (){
				if(!this.value){
					$('.search input').eq(1).val(this.value);
					$('.search input').eq(1).keyup();
				}
			};
			
			
			$('.search input').eq(0).keyup(function (ev){
				
				var oEvent = ev || event;
				if(oEvent.keyCode==13){
					$('.search input').eq(1).val(this.value);
					$('.search input').eq(1).keyup();
				}
			});
		 },
		 formatNoMatches:function(){
			 return '没有搜索结果'
		 },
		 formatLoadingMessage:function(){
			  return '正在努力加载中...';
		 },
		 columns: [
	
			{  
			  field: 'conpanyname',  
			  title: '发包方公司名称'  
			}, {  
			  field: 'demandname',  
			  title: '需求名称'  
			}, {  
			  field: 'demandquantity',  
			  title: '需求量'  
			}, {  
			  field: 'finishnum',  
			  title: '递交量'  
			}, 
			 {  
			  field: 'finishnum',  
			  title: '递交55量',
			  formatter:function (data,row,b){
				//console.log(data,row,b);
				return data;
			  },
			  footerFormatter(data){
				var count = 0;
				data.map(function (data,index){
					console.log(data,index);
					count += data.finishnum;
				});
				
				return count;
			  }
			  
			}, 
			 {  
			  field: 'reporturl',  
			  title: '成单报告',
			  formatter:function (data,row,b){
				//console.log(data,row,b);
				return '<a href="'+imagesurl+row.reporturl+'">下载</a>';
			  }
			}, 
			 {  
			  field: 'downloadcount',  
			  title: '状态',
			  formatter:function (data,row,b){
				if(row.downloadcount>0){
					return '已下载';
				}else{
					return '未下载';
				}
			  }			  
			}, 
			 {  
			  field: 'reporttime',  
			  title: '统计时间'  
			}, 
			/*
			{  
			  field: '',  
			  title: '上传时间'  
			}, 
			*/
			{  
			  field: 'sendstatus',  
			  title: '操作' ,
			  'class':'handle',
			  formatter:function (data,row,b){
				//console.log($.encode(JSON.stringify(row)));
				return '<div class="btn btn-primary btn-lg"  data-requiredata="'+$.encode(JSON.stringify(row))+'"  >编辑</div>';

			  }
			}
			]  
			
	});
	
	
	
	//patch 
	
	
	$('.determine').click(function (){
		var url = domain137 + '/dba'
		var start_date = $('.start_date').val();
		var finishnum = $('.finishnum').val();
		//var reporturl2 =  $('.reporturl2').attr('data-path');
		//	start_dateerror
							//finishnumtwoerror
		if(start_date){
			$('.start_dateerror').hide();
		}else{
			$('.start_dateerror').html('统计时间不能为空').show();
		}
		if(finishnum){
			$('.finishnumerror').hide();
			if(finishnum<1){
				$('.finishnumerror').html('请填写大于1的数据').show();
			}
		}else{
			$('.finishnumerror').html('递交量不能为空').show();
		}
		
	
		if($('.msg-error:visible').length){
			return;
		}
	
		$.when($.ajax({
			type:'PATCH',
			url:url,
			contentType:'application/json',
			data:JSON.stringify({
			   "stid":$('.reportid').html(), 
			   "pid":requiredata.id, 
			   "releasenum": parseInt($('.finishnum').val()), 
			   "censusfileUrl": $('.reporturl1').attr('data-path'),
			   "censusday":$('.reporttime').val(),
		   })
		})).then(function (data){
			//debugger;
			if(data.code == 0){
				$('#myModal').modal('hide');
				$table.bootstrapTable('refresh');
			}
			
		}).fail(function (data){
			//debugger;
		});
	});
	
	
	
	//add
	$('.determine2').click(function (){
		var start_date2 = $('.start_date2').val();
		var finishnum2 = $('.finishnum2').val();
		var reporturl2 =  $('.reporturl2').attr('data-path');
		//	start_dateerror
							//finishnumtwoerror
		if(start_date2){
			$('.start_datetwoerror').hide();
		}else{
			$('.start_datetwoerror').html('统计时间不能为空').show();
		}
		if(finishnum2){
			$('.finishnumtwoerror').hide();
			if(finishnum2<1){
				$('.finishnumtwoerror').html('请填写大于1的数据').show();
			}
			
		}else{
			$('.finishnumtwoerror').html('递交量不能为空').show();
		}
		
		if(reporturl2){
			$('.reporturl2error').hide();
		}else{
			$('.reporturl2error').html('请您上传成单报告').show();
		}
		if($('.msg-error:visible').length){
			return;
		}
		//return;
		var url = domain137 + '/addccjorder';
		
		$.when($.ajax({
			type:'POST',
			url:url,
			contentType:'application/json',
			data:JSON.stringify({
				//pid就是需求id
			   "pid":requiredata.id, 
			   //"pid":"", 
			   "ccuserid":requiredata.customerid,
			   "finishnum":  parseInt($('.finishnum2').val()), 
			   "reporturl": $('.reporturl2').attr('data-path'),
			   "reporttime":$('.reporttime2').val(),
		   })
		})).then(function (data){
			//$('#myModal2').modal('hide');
			if(data.code == 1){
				$('#myModal2').modal('hide');
				$table.bootstrapTable('refresh');
			}
		}).fail(function (data){
			//debugger;
		});
	});
	
	
	
	$('.addone').click(function (){
		
		//$('.uniqid2').html(requiredata.id);
		$('.reporttime2').val('');
		$('.finishnum2').val('');
		$('.uploadname').html('');
		$('.reporturl2 .salepad.test').html('点击上传');
		$('.msg-error').hide();
		$('.reporturl2').attr('data-path','');
		$('.uniquename2').html(requiredata.uniquename);
		$('.demandquantity2').html(requiredata.demandquantity);	
		$('#myModal2').modal('show');
		
	});
	
	/*编辑*/
	$('#table').on('click','.handle .btn-primary',function (){
		
		//var servicetype = $(this).attr('data-servicetype');
		var patchrequiredata = $(this).attr('data-requiredata');
		patchrequiredata = JSON.parse($.decode(patchrequiredata));

		
		//debugger;
		$('.uploadname').html('');
		$('.reporttime').val('');
		$('.reporttime').val(patchrequiredata.reporttime);
		
		$('.finishnum').val(0);
		$('.finishnum').val(patchrequiredata.finishnum);
		//debugger;
		
		$('.reportid').html(patchrequiredata.reportid);
		
		$('.uniquename').html(patchrequiredata.uniquename);
		$('.demandquantity').html(patchrequiredata.demandquantity);
		
											
		if(patchrequiredata.reporturl){
			$('.reporturl').attr('href',imagesurl+patchrequiredata.reporturl).html('下载');
		}else{
			$('.reporturl').attr('href','javascript:;').html('暂无');
		}
		//debugger;
		$('#myModal').modal('show');
		console.log(patchrequiredata);
		
	});
	
	$('.cancel').click(function (){
		//线上环境地址
		location.href = 'list.html'
	});
	
	
	var newDate = new Date();
	var time = newDate.toJSON();
	$(".start_date2")
	 .datetimepicker({
			language:  'zh-CN',
			 weekStart: 1,
			 todayBtn:  1,
			 autoclose: 1,
			 todayHighlight: 1,
			 startView: 2,
			 minView: 2,
			 forceParse: 0,
			 format: 'yyyy-mm-dd',
			 startDate:new Date(time),
	}).on("click",function(ev){
			$(".start_date").datetimepicker("setEndDate", $(".end_date").val());
	}).on("change",function(ev){
		//debugger;
		$(".start_date").val();
		$(".startDate").html($(".start_date").val());
		$(".start_date").blur();
	}).on("blur",function(ev){
		if(isNull($(".start_date").val())){
			$(this).parent().find("p.error").eq(0).show();
		}else{
			$(this).parent().find("p.error").eq(0).hide();
		}
	});
	 $(".start_date")
	 .datetimepicker({
			language:  'zh-CN',
			 weekStart: 1,
			 todayBtn:  1,
			 autoclose: 1,
			 todayHighlight: 1,
			 startView: 2,
			 minView: 2,
			 forceParse: 0,
			 format: 'yyyy-mm-dd',
			 startDate:new Date(time),
	}).on("click",function(ev){
			$(".start_date").datetimepicker("setEndDate", $(".end_date").val());
	}).on("change",function(ev){
		//debugger;
		$(".start_date").val();
		$(".startDate").html($(".start_date").val());
		$(".start_date").blur();
	}).on("blur",function(ev){
		if(isNull($(".start_date").val())){
			$(this).parent().find("p.error").eq(0).show();
		}else{
			$(this).parent().find("p.error").eq(0).hide();
		}
	});
					
	$(".end_date").datetimepicker({
				language:  'zh-CN',
					 weekStart: 1,
					 todayBtn:  1,
					 autoclose: 1,
					 todayHighlight: 1,
					 startView: 3,
					 minView: 3,
					 forceParse: 0,
					 format: 'yyyy-mm',
	}).on("click", function (ev) {
			$(".end_date").datetimepicker("setStartDate", $(".start_date").val());
	}).on("change",function(ev){
	$(".endDate").html($(".end_date").val());
	$(".end_date").blur();
	}).on("blur",function(ev){
		if(isNull($(".end_date").val())){
			$(this).parent().find("p.error").eq(1).show();
		}else{
			$(this).parent().find("p.error").eq(1).hide();
		}
	});

</script>
<script>
function getSignaturedays(parm){
	
	if(!parm){
		return;
	}
	
	if(!parm.fileName){
		return;
	}
	
	var xmlhttp = null;
    if (window.XMLHttpRequest){
        xmlhttp=new XMLHttpRequest();
    }else if (window.ActiveXObject){
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }

	if (xmlhttp){
      
        var census = parm.fileName;
		/*后台签名上传*/
         //https://back.mshuoke.com/aliOrder/customerDelve.do?stid=undefined&type=fbxq 
		 //aliOrder/census.do
        serverUrl = serverUrlpre +'/aliOrder/census.do?stid='+parm.stid+'&type='+census;
       
        xmlhttp.open( "GET", serverUrl, false );
        xmlhttp.send( null );
        return xmlhttp.responseText
    }else{
        alert("Your browser does not support XMLHTTP.");
    }
}


	

	
	/*上传到ali云并且判断是否成功*/
function uploadByForm(currentIdEle,host) {
	  /*模拟二进制流*/
	  var formData = new FormData(currentIdEle.find('form')[0]);
	// oMyForm.append("username", "Groucho");

	  formData.append("callback", "callback");
	  var url = "https://mso.oss-cn-shanghai.aliyuncs.com"; 
	//debugger;
	function setingpic(host,formData){
		return $.when(
			$.ajax({  
				url : host,  
				type : 'POST',  
				data : formData,  
				processData : false,  
				contentType : false
			})
		)
	}
	
	/*
	  $.ajax({
            url: param.contentHostName,
            data: request,
            processData: false,
            cache: false,
            async: false,
            contentType: false,
            //关键是要设置contentType 为false，不然发出的请求头 没有boundary
            //该参数是让jQuery去判断contentType
            type: "POST",
            success: function (data, textStatus, request) {
                if (textStatus === "nocontent") {
                    callBack(fileFullName);
                    alert("success!");
                } else {
                    alert(textStatus);
                }
            }
        });
		*/
	//debugger;
	
	var seting = setingpic(host,formData);
	//debugger;
	seting.then(function (data){
		$('.msg-error.hy').removeClass('fail');
		$('.msg-error.hy').hide();
		//console.log('上传成功');
	});
	
	seting.fail(function (data){
		currentIdEle.find('.msg-error.hy').show();
		currentIdEle.find('.msg-error.hy').addClass('fail');
		currentIdEle.find('.msg-error.hy').html('您上传失败请从新上传！');
	});
		
 }  




 $(document).on('click',".salepad",function (ev){
 
	var target = ev.currentTarget;
	var currentIdEle = $(target).parents('div.upload');
	
	/*通过id识别every type*/
	currentUploadId = currentIdEle.attr('data-index');
	
	//console.log(currentIdEle,currentUploadId);
	
	/*获取签名*/
	//https://back.mshuoke.com/aliOrder/census.do?stid=607edf91ed6248a681f6f8a7e77e7ea1&type=census
	//https://back.mshuoke.com/aliOrder/census.do?stid=607edf91ed6248a681f6f8a7e77e7ea1
	//&type=census
	
	resultSignature =  JSON.parse(getSignaturedays({fileName:'census',stid:'dba'+requiredata.id}));
	

	currentIdEle.find('.file')[0].onchange = function (){
		
		//var typeArr = ['image/jpeg','image/png','image/bmp'];
		var filesort = ['zip','rar','doc','docx','xls','xlsx'];
		var file = this.files[0];
		var flag = false;
		//debugger;
		filesort.map(function (data,index){
			
			var filename = file.name.split('.');
			filename = filename[filename.length-1]
			if(filename==data){
				flag = true;
			}
		});
		
		
		/*图片格式验证*/
		if(!flag){
			currentIdEle.find('.msg-error.hy').show();
			currentIdEle.find('.msg-error.hy').html('请您上传,zip,rar,doc,docx,xls,xlsx');
			return;
		}
		
		
		/*大小验证*/
		if((file.size/1024)>3072){
			//debugger;
			currentIdEle.find('.msg-error.hy').show();
			currentIdEle.find('.msg-error.hy').removeClass('fail');
			currentIdEle.find('.msg-error.hy').html('请您上传小于3M的图片');
			return;
		}else{
			currentIdEle.find('.msg-error.hy').hide();
		}
		
		
		
		
		/*设置签名信息*/
		currentIdEle.find('form')[0].action = resultSignature.host;
		currentIdEle.find('.idkey').val(resultSignature.dir+'${filename}');
		currentIdEle.find('.idpolicy').val(resultSignature.policy);
		currentIdEle.find('.idOSSAccessKeyId').val(resultSignature.accessid);
		currentIdEle.find('.idSignature').val(resultSignature.signature);
		
		/*组合path路径给后台*/
		
		var _path = resultSignature.dir+file.name;
		
		/*设置在每个自己身上path*/
		currentIdEle.attr('data-path',_path);

		/*设置图片路径*/
		var readerd = new FileReader();
		readerd.readAsDataURL(file);
		readerd.onload = function (e) {
			currentIdEle.find('div.salepad').html('');
			//currentIdEle.find('div.salepad').append('<a href="'+this.result+'">上传成功</a>');
			currentIdEle.find('div.salepad').append('<a href="javascript:;">上传成功</a>');
			console.log(file.name);
			$('.uploadname').html('文件名：'+file.name);
		   ///currentIdEle.find('div.salepad img')[0].src = this.result;
		}
		
		uploadByForm(currentIdEle,currentIdEle.find('form')[0].action);
	};
	
	return currentIdEle.find('.file').click();
});

</script>

</body>
</html>