<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Bootstrap Table Examples</title>


	<link rel="stylesheet" href="../css/bootstrap.min.css" />
	<link rel="stylesheet" href="../css/bootstrap-table.css" />
	<link rel="stylesheet" href="../css/bootstrap-datetimepicker.css" />
	
	
	<script src="../js/jquery.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js"></script>

	<script src="../js/bootstrap-table.min.js" type="text/javascript"></script>
	<script src="../js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
	<script src="../js/url.js" type="text/javascript"></script>
	<script src="../js/mock.js" type="text/javascript"></script>
	<script src="../js/myself-function/main.js" type="text/javascript"></script>
	
	<script src="../js/PerfectData_upload-darren.js"></script>
	
	<style>
		#forlogin { display:none; background:#ffffff;  overflow:hidden; height:100%; }
		*{ padding:0; margin:0; }
		ul li { list-style-type:none; }
		#forlogin ul { width:100%; overflow:hidden; margin-top:20px;  }
		#forlogin ul li { float:left; width:50%; }
		
		#forlogin ul li.first {width:60px; text-align:right; }
		#forlogin ul.industry{ margin-top:30px; }
		#forlogin ul.industry li {  }
		#forlogin ul.industry li input { float:left;  }
		#forlogin ul.high li.high-n   { text-align:left;  }
		
		#forlogin ul li.last  { padding-left:20px;  }
		#forlogin ul li .running { float:left;  width:70px; height:20px; }
		#forlogin ul li .outOff { float:left; width:70px; height:20px; }
		#forlogin ul li .outOff  span { float:left; margin-top:2px; margin-left:5px;  display:inline-table; }
		#forlogin ul li .running  span { float:left; margin-top:2px;    margin-left:5px;   display:inline-table; }
		#forlogin ul li .outOff input { float:left; }
		#forlogin ul li .running input { float:left; }
		#forlogin ul.descening li input { float:left; }
		#addIndustry  { margin-top:20px; }
		#toolbar { width:120px; } 
		.industrySetting { width:100%; overflow:hidden; margin-top:20px; margin-bottom:0; }
		.industrySetting li { float:left; }
		.search-box { overflow-y:hidden; padding-bottom:3px; min-width:1200px; }
		
		
		.search-box  #toolbar {margin-left:20px; float:left; margin-top:10px; margin-bottom:10px; }
		.bootstrap-table { margin-top:15px; }
		
		
		@media (min-width: 100px) {
			.container {
				width: auto;
			}
		}
		
		.pull-right1 { float:left; }
		.pull-right1.select { width:127px; }
		.search-box { margin-top:10px; }
		.bootstrap-table  .fixed-table-toolbar { height:0; }
		
		.data-box {
			width: 330px;
			height: 30px;
			border-radius: 6px;
			border: 1px solid #e8e8e8;
			padding-bottom: 0;
			position: relative;
			float:left; 
			margin-top:2px;
		}
		
		.data-box input {
			color: #a7a7a7;
			width: 150px;
			border: none;
			text-align: center;
			line-height: 28px;
		}
		
		.search-btn { margin-left:20px; }
		th,td { text-align:center; }
		
		
		
		
		
		
		
		
		.modal-dialog { width:860px; }
.modal-body-title { margin-top:10px; border-bottom:1px solid #e5e5e5; padding-bottom:15px;  }
ul li { list-style:none; }
.main-title-box { overflow:hidden; }
.main-title { width:10px; height:20px; background:rgba(255, 153, 0, 1); display:block; float:left; }
.main-box { margin-top:20px; overflow:hidden;  }
.main-txt { margin-left:10px; }
.main-list-item { float:left; width:100%; }
.main-list-item.basicdetail li { margin-top:15px; }
.main-list-item li { line-height:38px; display:table; width:100%; margin-top:10px; }
.main-list-item li span:nth-child(1){ float:left; font-weight:700; width:120px; text-align:right; font-family: 'Arial Negreta', 'Arial';}
.btn-primary { background:#5cb85c; border-color:#4cae4c; }

.conpanyname { float:left; }

.main-list-item.conpany { margin-bottom:20px; }
.error.time { display:none; }
.modal-body-title.special { margin-top:30px; }
.modal-body-title.noborder { border-bottom:0; padding:0;}

 .btn-success.btn-lg { padding:6px 12px; }
.btn-lg, .btn-group-lg>.btn { font-size:14px; }
.pull-right1.search { margin-top:0; float:left; width:250px; }

.modal-body { max-height:500px; overflow-y:auto; }

.vestingtime  .data-box { width:160px; }
.vestingtime  .data-box { width:160px;  height:auto; }
.basicnot { display:none; }


.pull-right1.search {
    margin-top: 0;
    float: left;
    width: 317px;
}

.pull-right1.select {
    width: 127px;
    margin-left: 5px;
	margin-top:10px;
}

.salepad { float:left; width:220px; height:138px; border:1px solid #000000; text-align:center;line-height:138px; cursor:pointer; overflow:hidden; }

.salepad img { width:100%; height:100%; }


.main-list-item li.upload { width:220px; height:180px;  float:left;  margin-left:10px;  }
.main-list-item li.upload { display:none; }
.main-list-item li:nth-child(1).upload { display:block; }
.controlUpload { overflow:hidden; list-style:none; }

.controlUpload li{ float:left; width:auto; margin-top:3px; }
.controlUpload li:nth-child(2){ margin-left:20px; }
.radio-inline, .checkbox-inline { padding-left:10px; margin-top:-6px; }

.msg-error.hy { color:red; font-size:14px; font-weight:normal; }

.main-list-item li.upload  p { margin:0; line-height:20px; }
.main-list-item li.upload  p.first{ margin-top:6px; }
.form-control { width:200px; }
.form-control.search { width:100%; }

.main-list-item li.upload.compimg { margin-left:0; }


.bootstrap-table .fixed-table-toolbar {  overflow:-hidden; }
.pull-left.search { display:none; height:auto;}

.bootstrap-table { margin-top:-30px; }


textarea {
    resize: none;
    width: 200px;
    height: 80px;
    overflow: hidden;
}

.error { color:red; font-weight:normal; line-height:20px; margin-left:10px; display:none; }


	</style>
</head>
<body>
    <div class="container">
		<div class="search-box">
			<div class="fixed-table-toolbar">
				<div class="pull-right1 search">
					<input class="form-control search" type="text" placeholder="Search" >
				</div>
				
				
				<!--
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">选择业务类型</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">选择审核人</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				
				<div class="pull-right1 select">
					<select style="width:auto;" class="form-control BDstaff">
						<option value="1">选择BD专员</option>
						
					</select>
				</div>
				-->
				<!--
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">选择状态</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				<div class="data-box">
						<input autoComplete="off" placeholder="开始日期" type="text" class="form_date start_date" readOnly /><i class="date_icon"></i><span>~</span>
						<input autoComplete="off" placeholder="结束日期" type="text" class="form_date end_date" readOnly /><i class="date_icon"></i>
						<p class="error time">请填写开始日期</p><p class="error time">请填写结束日期</p>
				</div>
				<div class="data-box">
						<input autoComplete="off" placeholder="开始日期" type="text" class="form_date start_date" readOnly /><i class="date_icon"></i><span>~</span>
						<input autoComplete="off" placeholder="结束日期" type="text" class="form_date end_date" readOnly /><i class="date_icon"></i>
						<p class="error time">请填写开始日期</p><p class="error time">请填写结束日期</p>
				</div>
				-->
				<div class="pull-right1 select search-btn">
					<button type="button" class="btn btn-success">搜索</button>
				</div>
			</div>
		</div>
	
	  <table id="table">
            
       </table>
	<div id="forlogin">
		 <div>
			
			<ul class="high">
				<li  class="first" >分类级别:</li>
				<li class="high-n last">一级分类</li>
			</ul>
			<ul>
				<li  class="first" >状态:</li>
				<li class="last">
					<div class="running"><input type="radio" value="1"/><span>启用</span></div>
					<div class="outOff"><input type="radio" value="2" /><span>停用</span></div>
				</li>
			</ul>
			<ul class="descening">
				<li  class="first" >排序值</li>
				<li class="last"><input placeholder="请输入排序值，值越大越靠前"/></li>
			</ul>
		 </div>
	</div>
	 
	<!--<button id="addIndustry" class="btn btn-default">新增行业</button>--> 
	</div>
	
	
	
	
	<!--弹出成-->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog main">
	
	
	
	
	






	</div>




</div>



<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static'>
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="myModalLabel">提示</h4>
      </div>
      <div class="modal-body">
        请稍候。。。
      </div>
    </div>
  </div>
</div>



<script>

	$.detailpage = 	`<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					用户资料
				</h4>
			</div>
			<div class="modal-body">
				
				<div class="modal-body-title special noborder">
					<span class="main-title"></span>
					<span class="main-txt">用户资料：</span>
					<span class="main-txt demandid"></span>
				</div>
				<div class="main-box">
					
					<ul class="main-list-item">
						<li>
							<span>ID：</span>
							<span class="jfuid"></span>
						</li>
						<li>
							<span>用户名：</span>
							<span class="jfuname"></span>
						</li>
							<li>
							<span>称呼：</span>
							<span>
								<input class="form-control name" type="text" />
							</span>
						</li>
						<li>
							<span>公司名：</span>
							<span class="compname"></span>
						</li>
					</ul>		
				</div>
				<div class="modal-body-title noborder"><span class="main-title"></span><span class="main-txt">基本信息：</span></div>
				<div class="main-box">
					<ul class="main-list-item basicdetail">
						<li>
							<span>真实姓名：</span>
							<span>
								<input class="form-control realname" type="text" />
							</span>
						</li>
						<li>
							<span>手机号：</span>
							<span>
								<input class="form-control jfumobilephone" type="text" />
							</span>
						</li>
							<li>
							<span>电子邮箱：</span>
							<span>
								<input class="form-control compemail" type="text" />
							</span>
						</li>
						<li>
							<span>wechat：</span>
							<span>
								<input class="form-control weixin" type="text" />
							</span>
						</li>
						<li>
							<span>qq：</span>
							<span>
								<input class="form-control qq" type="text" />
							</span>
						</li>
						<li>
							<span style="float:left;">品牌名：</span>
							<span>
								<input class="form-control brandname" type="text" />
							</span>
						</li>
						<li>
							<span style="float:left;">公司网址：</span>
							<span>
								<input class="form-control compwebsite" type="text" />
							</span>
						</li>
							<li>
							<span style="float:left;">公司图片：</span>
							<ul>
								<li class="upload compimg" data-index="5">
									
									<form id="salepad" action=""  enctype="" >
										<div>
											<span style="display:none;">文件路径</span>
											<input style="display:none;" class="idkey" type="text" name="key" value="" />
											<span style="display:none;">OSSAccessKeyId</span>
											<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="" />
											<span style="display:none;">policy</span>
											<input style="display:none;" class="idpolicy" type="text" name="policy" value="" />
											
											<input style="display:none;" class="status" type="text" name="success_action_status" value="200" />
											

											<span style="display:none;">Signature</span>
											<input style="display:none;" class="idSignature" type="text" name="Signature" value="" />
											
											<input  style="display:none;" name="file" type="file"  class="file" />
										</div>
									</form>
									<div class="salepad test">
										点击上传
									</div>
									
									<p class="msg-error hy"></p>
								</li>
							</ul>
							
						</li>
					</ul>
				</div>
				
				
				
				
				
					<div class="modal-body-title noborder saletemplate customtags">
					<span class="main-title"></span><span class="main-txt">企业认证信息：</span></div>
					<div class="main-box saletemplate customtags">
						
						<ul class="main-list-item">
							<li>
								<span>公司全称：</span>
								<span class="compfullname"></span>
							</li>
							<li>
								<span>营业执照注册号：</span>
								<span class="licensecode"></span>
							</li>
							
							<li>
								<span>所属行业：</span>
								<span class="compind"></span>
							</li>
							
							<li>
								<span>公司地址：</span>
								<span class="compaddr"></span>
							</li>
							
							<li>
								<span>法人代表：</span>
								<span class="corporation"></span>
							</li>
							
							
						</ul>
					</div>
				
				
			

				<div class="modal-body-title special noborder attachment">
					<span class="main-title"></span><span class="main-txt">企业认证：</span>
				
				</div>
				
				<div class="main-box attachment">
					 <div>
						
					 </div>
					<ol class="controlUpload">
						<li>
							 
							<input type="radio" class="optionsRadiosinline one" name="optionsRadios" />
							<label class="checkbox-inline">三证合一 </label>
						</li>
						<li>
							<input type="radio" class="optionsRadiosinline two"  name="optionsRadios"    />
							<label class="checkbox-inline">三证分离</label>
						</li>
					</ol>
					  
					
					<ul class="main-list-item">
							<li class="upload updata fulllicense" data-index="1">
								
								<form id="salepad" action=""  enctype="" >
									<div>
										<span style="display:none;">文件路径</span>
										<input style="display:none;" class="idkey" type="text" name="key" value="" />
										<span style="display:none;">OSSAccessKeyId</span>
										<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="" />
										<span style="display:none;">policy</span>
										<input style="display:none;" class="idpolicy" type="text" name="policy" value="" />
										
										<input style="display:none;" class="status" type="text" name="success_action_status" value="200" />
										

										<span style="display:none;">Signature</span>
										<input style="display:none;" class="idSignature" type="text" name="Signature" value="" />
										
										<input  style="display:none;" name="file" type="file"  class="file" />
									</div>
								</form>
								<div class="salepad test">
									点击上传
								</div>
								<p class="first">营业执照</p>
								<p class="msg-error hy"></p>
								
							</li>
							<li class="upload updata complicense" data-index="2">
								
								<form id="salepad" action=""  enctype="" >
									<div>
										<span style="display:none;">文件路径</span>
										<input style="display:none;" class="idkey" type="text" name="key" value="" />
										<span style="display:none;">OSSAccessKeyId</span>
										<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="" />
										<span style="display:none;">policy</span>
										<input style="display:none;" class="idpolicy" type="text" name="policy" value="" />
										
										<input style="display:none;" class="status" type="text" name="success_action_status" value="200" />
										

										<span style="display:none;">Signature</span>
										<input style="display:none;" class="idSignature" type="text" name="Signature" value="" />
										
										<input  style="display:none;" name="file" type="file"  class="file" />
									</div>
								</form>
								<div class="salepad test">
									点击上传
								</div>
								<p class="first">营业执照</p>
								<p class="msg-error hy"></p>
								
							</li>
							<li class="upload updata comptaxcer" data-index="3">
								
								<form id="salepad" action=""  enctype="" >
									<div>
										<span style="display:none;">文件路径</span>
										<input style="display:none;" class="idkey" type="text" name="key" value="" />
										<span style="display:none;">OSSAccessKeyId</span>
										<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="" />
										<span style="display:none;">policy</span>
										<input style="display:none;" class="idpolicy" type="text" name="policy" value="" />
										
										<input style="display:none;" class="status" type="text" name="success_action_status" value="200" />
										

										<span style="display:none;">Signature</span>
										<input style="display:none;" class="idSignature" type="text" name="Signature" value="" />
										
										<input  style="display:none;" name="file" type="file"  class="file" />
									</div>
								</form>
								<div class="salepad test">
									点击上传
								</div>
								<p class="first">税务登记证</p>
								<p class="msg-error hy"></p>
								
							</li>
							<li class="upload updata comporgcode" data-index="4">
								
								<form id="salepad" action=""  enctype="" >
									<div>
										<span style="display:none;">文件路径</span>
										<input style="display:none;" class="idkey" type="text" name="key" value="" />
										<span style="display:none;">OSSAccessKeyId</span>
										<input style="display:none;" class="idOSSAccessKeyId" type="text" name="OSSAccessKeyId" value="" />
										<span style="display:none;">policy</span>
										<input style="display:none;" class="idpolicy" type="text" name="policy" value="" />
										
										<input style="display:none;" class="status" type="text" name="success_action_status" value="200" />
										

										<span style="display:none;">Signature</span>
										<input style="display:none;" class="idSignature" type="text" name="Signature" value="" />
										
										<input  style="display:none;" name="file" type="file"  class="file" />
									</div>
								</form>
								<div class="salepad test">
									点击上传
								</div>
								<p class="first">组织机构代码证</p>
								<p class="msg-error hy"></p>
							</li>
					</ul>
				</div>
				
			
				<div class="modal-body-title"></div>
				<div class="main-box">
					<div class="main-title-box"><span class="main-title"></span><span class="main-txt">操作：</span><div>
					<ul class="main-list-item conpany">
						<li>
							<span class="conpanyname">是否托管：</span>
							<ol class="controlUpload ">
								<li>
									<input type="radio" class="optionsRadiosinline trusteeship" value="0" name="optionsRadiosinline" />
									<label class="checkbox-inline">非托管 </label>
								</li>
								<li>
									<input type="radio" class="optionsRadiosinline trusteeship" value="1"  name="optionsRadiosinline"    />
									<label class="checkbox-inline">托管</label>
								</li>
							</ol>
						</li>
						<li>
							<span class="conpanyname">分配专员：</span>
							<div class="pull-right1 select">
									<select class="form-control BDstaff2">
										
									</select>
							</div>
						</li>
						<li>
							<span class="conpanyname">是否冻结：</span>
							<div class="pull-right1 select">
									<select class="form-control jfudisable">
										<option value="1">启用</option>
										<option value="2">停用</option>
									</select>
							</div>
							
							<li class="flag">
							<span>暂停原因：</span>
							<div style=" width:600px;" class="pull-right1 select">
								<textarea name="disableremark" class="disableremark">
								
								</textarea>
								<label id="disableremark-error" class="error" for="disableremark" >请填写暂停原因！</label>
							</div>
						</li>
						</li>
					</ul>
				</div>
			</div>
			
		
		
	</div><!-- /.modal-dialog -->
	
	</div>
	<div class="modal-footer">
				<button type="button"  class="btn determine btn-primary"  >
					确认
				</button>
				<button type="button"  data-dismiss="modal"  class="btn btn-default" >
					取消
		</button>
		</div><!-- /.modal-content -->
</div>`;

</script>
<script>
/*新增行业*/
	
/*
	
	{
  "code": "0",
  "msg": "success",
  "data": {
    "jfuid": "用户id",
    "jfuname": "用户名",
    "name": "称呼",
    "compname": "公司名",
    "realname": "真实姓名",
    "jfumobilephone": "手机号 ",
    "compemail": "电子邮箱",
    "qq": "qq",
    "weixin": "微信",
    "brandname": "品牌名",
    "compwebsite": "公司网址",
    "compimg": "公司图片",
    "compfullname": "公司全称",
    "licensecode": "营业执照注册号",
    "compind": "公司所属行业",
    "compaddr": "公司地址",
    "corporation": "法人代表",
    "fulllicense": "三证合一",
    "complicense": "营业执照",
    "comptaxcer": "税务登记证",
    "comporgcode": "组织机构代码",
    "trusteeship": "是否托管 0-非托管 1-托管",
    "jfudisable": "1-启用  2-停用",
    "sysName": "后台用户名",
    "sysId": "后台id",
    "distributionstate": "0-初始状态  1-已分配   2-跟踪处理中(注册,完善资料验证中)  3-驳回    4-审核通过处理完成 5-驳回再次提交",
    "approveremark": "审核意见"
  }
}

*/
	//domain137 = 'http://192.168.2.33:20005';
	var $table = $('#table');
	//文档地址http://bootstrap-table.wenzhixin.net.cn/zh-cn/documentation/
	//获取角色列表
	var rolelistdata;
	getRoleList();
	function getRoleList (){
		//GET 开发完成 /pasf/pt/sysusers
			var url = domain137 + "/pt/sysusers";

			//debugger;
			$.when($.ajax({
				url:url,
				//选择BD专员
				data:{rolename:'BD专员'},
				dataType:'json',
			})).then(function (data){
				//debugger;
				if(data.msg=="success"){
					//debugger;
					rolelistdata = data.data;
					
				}
			}).fail(function (data){
				//$('#loading').modal('hide');
				//debugger;
			});
		
	}
	
	

		var $table = $('#table');

		///bdusers/admin/users
			
		var url =  domain137 + '/bdusers/admin/users';

	
		
		$('.BDstaff').change(function (){
			/*获取某个bd专员的数据*/
			url = domain137 + '/bdusers/'+this.value+'/demands';

			$table.bootstrapTable('refresh',{url:url});
				
		});
		
		
		$table.bootstrapTable({
			url:url,
			 pagination: true, //分页
			 contentType:'application/json',
			 search:true,
			 showColumns:true,
			 searchAlign:'left',
			 checkbox:false,
			// pageSize:3,
			 queryParams:function (params){
			
				  var data = {time:new Date()};
				  data.limit = params.limit;
				  data.offset = params.offset;
				  data.size = 100000000;  
			   return  data;
			 },
			 sidePagination: "client",
			 responseHandler:function(res){
				var newJson = {};
				newJson.total = res.data.length;

				newJson.data = res.data;
				return newJson;
			 },
			 onLoadSuccess(){
				/*移动自带事件*/
				$('.search-btn button').click(function(){
					//debugger;
					$('.search input').eq(1).val($('.search input').eq(0).val());
					$('.search input').eq(1).keyup();
				});
				//debugger;
				
				/*当search 没有vlaue的时候*/
				$('.search input').eq(0)[0].oninput= function (){
					if(!this.value){
						$('.search input').eq(1).val(this.value);
						$('.search input').eq(1).keyup();
					}
				};
				
				
				$('.search input').eq(0).keyup(function (ev){
					
					var oEvent = ev || event;
					if(oEvent.keyCode==13){
						$('.search input').eq(1).val(this.value);
						$('.search input').eq(1).keyup();
					}
				});
			 },
			 formatNoMatches:function(){
				 return '没有搜索结果'
			 },
			 formatLoadingMessage:function(){
				  return '正在努力加载中...';
			 },
			 
		
			 columns: [ {  
				  field: 'jfuname',  
				  title: '用户名'  
				}, {  
				  field: 'compname',  
				  title: '公司名'  
				}, 
				 {  
				  field: 'compfullname',  
				  title: '公司全称'  
				}, 
				 {  
				  field: 'brandname',  
				  title: '品牌名'  
				}, 
				 {  
				  field: 'name',  
				  title: '称呼'  
				}, 
				 {  
				  field: 'sourceName',  
				  title: '来源',
				  
				}, 
				 {  
				  field: 'jfumobilephone',  
				  title: '手机号'  
				}, 
				{  
				  field: 'jfudisable',  
				  title: '是否冻结',
				  formatter:function (data,row,index){
					  var  arr = ['启用','停用'];
					  return arr[row.jfudisable-1];
				  }
				}, 
				{  
				  field: 'sysName',  
				  title: '审核人'  
				}, 
				{  
				  field: 'distributionstate',  
				  title: '状态',
				  formatter:function (data,row,index){
					 var arr = ['待审核','','','驳回','通过','再次提交'];
					 return arr[row.distributionstate];
				  }
				}, 
				{  
				  field: 'createtime',  
				  title: '注册时间'  
				}, 
				{  
				  field: 'releasetime',  
				  title: '审核时间'  
				}, 
				{  
				  field: 'audittime',  
				  title: '特殊说明'  
				}, 
				{  
				  field: 'sendstatus',  
				  title: '操作' ,
				  'class':'handle',
				  formatter:function (data,row,b){
					//var datarow = [row.servicetype,row.id];
					
					return '<div class="btn btn-primary btn-lg"  data-servicetype="'+row.servicetype+'"  data-jfuid="'+row.jfuid+'"  >查看用户详情</div>';

				  }
				}
				]  
				
		});


	


	/*查看详情*/
	$('#table').on('click','.handle .btn-primary',function (){
		//var servicetype = $(this).attr('data-servicetype');
		
		/*创建列表*/
		
		$('.modal-dialog.main').html($.detailpage);
		rolelistdata.map(function (data,index){
			
			$('.BDstaff2').append('<option value="'+data.userid+'">'+data.username+'</option>');
		});
		//debugger;
		
		
		
		
		var jfuid = $(this).attr('data-jfuid');
		//servicetype="标准发包"
		//debugger;
		getdetialdata(jfuid);
		
		//$('#loading').modal('show');
		
		$('#myModal').modal('show');
		
		
	});
	
	
	
	
		/*是否启用*/
	$(document).on('change','.jfudisable',function (){
		if(this.value == 2){
			$('.disableremark').parents('.flag').show();
		}else{
			$('.disableremark').parents('.flag').hide();
		}
	});
	
	
	
	//暂停原因	
	$(document).on('blur','.disableremark',function (){
		if($('.jfudisable').val()==2){
			console.log(this.value);
			if(this.value){
				$('#disableremark-error').hide();
			}else{
				$('#disableremark-error').show();
			}
		}
	});

	
	
	/*切换状态*/
	$(document).on('change','.optionsRadiosinline',function (){
			//debugger;
			if($(this).hasClass('one')){
				$('.main-list-item li.upload.updata').hide();
				$('.main-list-item li.upload.updata').eq(0).show();
			}
			
			if($(this).hasClass('two')){
				$('.main-list-item li.upload.updata').show();
				
				$('.main-list-item li.upload.updata').eq(0).hide();
			}
	});

	/*跟新专员BDstaff2*/
	
	
	
	
/*请求详情数据*/
//pasf/bdusers/{bduserid}/demands/{demandid}

function getdetialdata(jfuid){

	if(!jfuid)return;
	//GET 开发完成 /bdusers/all/users/{jfuid} 
	$('.determine').attr('jfuid',jfuid);
	var url = domain137 + '/bdusers/all/users/'+jfuid

	$.when($.ajax({
		url:url,
		dataType:'json',
	})).then(function (data){
		//debugger;
		if(data.msg=="success"){
			/*关闭加载层*/
			$('#loading').modal('hide');
		
			handleDetail(data.data);
		}
		
	}).fail(function (data){
		//$('#loading').modal('hide');
		//debugger;
	});
}

var demandata;
//PATCH /bdusers/all/users/{jfuid}
/*更新数据详情*/
	$(document).on('click','.determine',function (){
	
		
		$('textarea').blur();
		if($('.error:visible').length){
			return;
		}
		
		var jfuid = $(this).attr('jfuid');
		//debugger;
		//PATCH 开发完成 /bdusers/all/users/{jfuid} bd管理员专员更新用户详情

		var url = domain137 + '/bdusers/all/users/'+jfuid;
		
		//$('.vestingtime .end_date').val(data[name]);
		//统一收集数据
		
		/*称呼*/
		demandata.name = $('.form-control.name').val();
		/*真实姓名*/
		demandata.realname = $('.form-control.realname').val();
		
		//form-control jfumobilephone
		demandata.jfumobilephone = $('.form-control.jfumobilephone').val();
		
		//form-control compemail
		demandata.compemail = $('.form-control.compemail').val();
		
		//form-control weixin
		demandata.weixin = $('.form-control.weixin').val();
		
		//form-control qq
		demandata.qq = $('.form-control.qq').val();
		
		//form-control brandname
		demandata.brandname = $('.form-control.brandname').val();
		
		//form-control compwebsite
		demandata.compwebsite = $('.form-control.compwebsite').val();
		
		//optionsRadiosinline trusteeship 托管
		demandata.trusteeship = $('.trusteeship').get(0).checked?$('.trusteeship').get(0).value*1:($('.trusteeship').get(1).checked?$('.trusteeship').get(1).value*1:"");
		
		//form-control BDstaff2 //分配专员
		//demandata.realname = $('.form-control.BDstaff2').find('option:selected').text();
		
		//form-control jfudisable 是否冻结
		demandata.jfudisable = $('.form-control.jfudisable').val();
		
		
			//2停用 1 启用
		if(demandata.jfudisable == 2){
			demandata.disableremark = $('.disableremark').val();
		}
		
		//compimg
		
		//upload compimg
		var compimg = $('.upload.compimg').attr('data-path');
		var fulllicense = $('.upload.fulllicense').attr('data-path');
		var complicense = $('.upload.complicense').attr('data-path');
		var comptaxcer =  $('.upload.comptaxcer').attr('data-path');
		var comporgcode =  $('.upload.comporgcode').attr('data-path');
		
		if(compimg){
			demandata.compimg = compimg;
		}
		
		if(fulllicense){
			demandata.fulllicense = fulllicense;
		}else{
			if(complicense){
				demandata.complicense = complicense;
			}
			
			if(comptaxcer){
				demandata.comptaxcer = comptaxcer;
			}	
			
			if(comporgcode){
				demandata.comptaxcer = comptaxcer;
			}
		
		}
		
		
		$('#loading').modal('show');
		$('#myModal').modal('hide');
		

		//PATCH 开发完成 /bdusers/admin/users/{jfuid}/{USER_ID}
		/*跟新专员*/
		//console.log(jfuid,'67018442beb7424b850e658aa43af830');
		var url2 = domain137 + '/bdusers/admin/users/'+jfuid +'/'+$('.BDstaff2').val();
		$.when($.ajax({
			url:url2,
			type:'PATCH',
			contentType:'application/json',
			//data:JSON.stringify(demandata),
		})).then(function (data){
			if(data.msg == "success"){
				$('#loading').modal('hide');
			}
			
		}).fail(function (data){
		
		});
		
		
		
		
		
		
		
		/*跟新数据列表*/
		$.when($.ajax({
			url:url,
			type:'PATCH',
			contentType:'application/json',
			data:JSON.stringify(demandata),
		})).then(function (data){
			if(data.msg == "success"){
				$('#loading').modal('hide');
				
				$table.bootstrapTable('refresh');
				
			}
			
		}).fail(function (data){
		
		});
	});


/*处理详情*/
function setValuedata(data){
	//debugger;
	demandata = data;
	
	for(var name in data){
		//console.log(name);
		if(name == 'jfudisable'){
			
			$('.'+name).val(data[name]);
			if(data[name]==2){
				//debugger;
				$('.disableremark').parents('.flag').show();
			}else{
				$('.disableremark').parents('.flag').hide();
				$('.disableremark').val('');
			}
			
			
			
		}else if(name=="fulllicense" || name=="complicense" ||  name=="comptaxcer" || name=="comporgcode"){
			//'标签加价'
			/*切换类型*/

			
			if(name=="fulllicense"){
				//debugger;
				if(data[name]){
					$('.optionsRadiosinline.one').attr('checked',true);
					
					//$('.optionsRadiosinline').change();
					$('.main-list-item li.upload.updata').hide();
					$('.main-list-item li.upload.updata').eq(0).show();
				
					$('.'+name+' .salepad.test').html('<img src="'+imagesurl+data[name]+'">');
				}else{
					//continue;
					
				}
				
			}else{
				//debugger;
				if(data[name]){
					$('.optionsRadiosinline.two').attr('checked',true);
					$('.main-list-item li.upload.updata').show();
			
					$('.main-list-item li.upload.updata').eq(0).hide();
					
					$('.'+name+' .salepad.test').html('<img src="'+imagesurl+data[name]+'">');
				}else{
					continue;
				}
			}
			
			
			
		}else if(name=="trusteeship"){
		
			$('.'+name).eq(data[name]).prop("checked",true);
		}else if(name=="compind"){
			//debugger;
			if(data[name]){
				var compind  = JSON.parse(data[name]);
				if(compind && compind[0]){
					$('.'+name).html(compind[0]);
					if(compind[0] && compind[1]){
							$('.'+name).html(compind[0]+'-'+compind[1]);
					}
				}
			}
			
			
			
		}else if(name=="compimg"){
			// continue;
			if(data[name]){
				$('.upload.compimg .salepad.test').html('<img src="'+imagesurl+data[name]+'">');
			}
			
		}else if(name=="sysId"){
			//sysId //选择的专员ID
			$('.BDstaff2').val(data[name]);
		}else{
			//console.log($('.'+name).get(0).tagName);
			if($('.'+name).get(0)){
				if($('.'+name).get(0).tagName == 'INPUT'){
					$('.'+name).val(data[name]);
				}else{
					$('.'+name).html(data[name]);
				}
			}
		}
		
	}
	//debugger;

}


function handleDetail(data){
	
	setValuedata(data);

	$('#myModal').modal('show');
}

	var newDate = new Date();
	var time = newDate.toJSON();
	 $(".start_date")
	 .datetimepicker({
			language:  'zh-CN',
			 weekStart: 1,
			 todayBtn:  1,
			 autoclose: 1,
			 todayHighlight: 1,
			 startView: 2,
			 minView: 2,
			 forceParse: 0,
			 format: 'yyyy-mm-dd',
			 startDate:new Date(time),
	}).on("click",function(ev){
			$(".start_date").datetimepicker("setEndDate", $(".end_date").val());
	}).on("change",function(ev){
		$(".startDate").html($(".start_date").val());
		$(".start_date").blur();
	}).on("blur",function(ev){
		if(isNull($(".start_date").val())){
			$(this).parent().find("p.error").eq(0).show();
		}else{
			$(this).parent().find("p.error").eq(0).hide();
		}
	});
					
	$(".end_date").datetimepicker({
				language:  'zh-CN',
					 weekStart: 1,
					 todayBtn:  1,
					 autoclose: 1,
					 todayHighlight: 1,
					 startView: 2,
					 minView: 2,
					 forceParse: 0,
					 format: 'yyyy-mm-dd',
	}).on("click", function (ev) {
			$(".end_date").datetimepicker("setStartDate", $(".start_date").val());
	}).on("change",function(ev){
	$(".endDate").html($(".end_date").val());
	$(".end_date").blur();
	}).on("blur",function(ev){
		if(isNull($(".end_date").val())){
			$(this).parent().find("p.error").eq(1).show();
		}else{
			$(this).parent().find("p.error").eq(1).hide();
		}
	});



	


</script>
<script>
/*上传到ali云并且判断是否成功*/
function uploadByForm(currentIdEle,host) {
	  /*模拟二进制流*/
	  var formData = new FormData(currentIdEle.find('form')[0]);
	// oMyForm.append("username", "Groucho");
	  var url = "https://mso.oss-cn-shanghai.aliyuncs.com"; 

	function setingpic(host,formData){
		return $.when(
			$.ajax({  
				url : host,  
				type : 'POST',  
				data : formData,  
				processData : false,  
				contentType : false,  
			})
		)
	}
	//debugger;
	var seting = setingpic(host,formData);
	
	seting.then(function (data){
	//debugger;
		$('.msg-error.hy').removeClass('fail');
		$('.msg-error.hy').hide();
		//console.log('上传成功');
	});
	
	seting.fail(function (data){
		currentIdEle.find('.msg-error.hy').show();
		currentIdEle.find('.msg-error.hy').addClass('fail');
		currentIdEle.find('.msg-error.hy').html('您上传失败请从新上传！');
	});
		
 }  

 

 

 $(document).on('click',".salepad",function (ev){
 
	var target = ev.currentTarget;
	var currentIdEle = $(target).parents('li.upload');
	
	/*通过id识别every type*/
	currentUploadId = currentIdEle.attr('data-index');
	
	//console.log(currentIdEle,currentUploadId);
	
	/*获取签名*/
	resultSignature =  JSON.parse(getSignature({fileName:'credentials'}));
	
	
	currentIdEle.find('.file')[0].onchange = function (){
		
		var typeArr = ['image/jpeg','image/png','image/bmp'];
		var file = this.files[0];
		var flag = false;
		
		typeArr.map(function (data,index){
			if(file.type==data){
				flag = true;
			}
		});
		
		
		/*图片格式验证*/
		if(!flag){
			currentIdEle.find('.msg-error.hy').show();
			currentIdEle.find('.msg-error.hy').html('请您上传,jpg,jpeg,png,bmp!');
			return;
		}
		
		
		/*大小验证*/
		if((file.size/1024)>3072){
			//debugger;
			currentIdEle.find('.msg-error.hy').show();
			currentIdEle.find('.msg-error.hy').removeClass('fail');
			currentIdEle.find('.msg-error.hy').html('请您上传小于3M的图片');
			return;
		}else{
			currentIdEle.find('.msg-error.hy').hide();
		}
		
		
		
		
		/*设置签名信息*/
		currentIdEle.find('form')[0].action = resultSignature.host;
		currentIdEle.find('.idkey').val(resultSignature.dir+'${filename}');
		currentIdEle.find('.idpolicy').val(resultSignature.policy);
		currentIdEle.find('.idOSSAccessKeyId').val(resultSignature.accessid);
		currentIdEle.find('.idSignature').val(resultSignature.signature);
		
		/*组合path路径给后台*/
		
		var _path = resultSignature.dir+file.name;
		/*设置在每个自己身上path*/
		currentIdEle.attr('data-path',_path);
		
		
		/*设置图片路径*/
		var readerd = new FileReader();
		readerd.readAsDataURL(file);
		readerd.onload = function (e) {
			currentIdEle.find('div.salepad').html('');
			currentIdEle.find('div.salepad').append('<img src="'+this.result+'"/>');
		   ///currentIdEle.find('div.salepad img')[0].src = this.result;
		}
		
		uploadByForm(currentIdEle,currentIdEle.find('form')[0].action);
	};
	
	return currentIdEle.find('.file').click();
	
	
});
		
		
		

		

</script>

</body>
</html>