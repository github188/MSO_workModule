<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Bootstrap Table Examples</title>


	<link rel="stylesheet" href="../css/bootstrap.min.css" />
	<link rel="stylesheet" href="../css/bootstrap-table.css" />
	<link rel="stylesheet" href="../css/bootstrap-datetimepicker.css" />
	
	
	<script src="../js/jquery.js" type="text/javascript"></script>
    <script src="../js/bootstrap.min.js"></script>

	<script src="../js/bootstrap-table.min.js" type="text/javascript"></script>
	<script src="../js/bootstrap-datetimepicker.min.js" type="text/javascript"></script>
	<script src="../js/url.js" type="text/javascript"></script>
	<script src="../js/myself-function/main.js"></script>

	<script src="../js/mock.js" type="text/javascript"></script>

	
	<style>
		#forlogin { display:none; background:#ffffff;  overflow:hidden; height:100%; }
		*{ padding:0; margin:0; }
		ul li { list-style-type:none; }
		#forlogin ul { width:100%; overflow:hidden; margin-top:20px;  }
		#forlogin ul li { float:left; width:50%; }
		
		#forlogin ul li.first {width:60px; text-align:right; }
		#forlogin ul.industry{ margin-top:30px; }
		#forlogin ul.industry li {  }
		#forlogin ul.industry li input { float:left;  }
		#forlogin ul.high li.high-n   { text-align:left;  }
		
		#forlogin ul li.last  { padding-left:20px;  }
		#forlogin ul li .running { float:left;  width:70px; height:20px; }
		#forlogin ul li .outOff { float:left; width:70px; height:20px; }
		#forlogin ul li .outOff  span { float:left; margin-top:2px; margin-left:5px;  display:inline-table; }
		#forlogin ul li .running  span { float:left; margin-top:2px;    margin-left:5px;   display:inline-table; }
		#forlogin ul li .outOff input { float:left; }
		#forlogin ul li .running input { float:left; }
		#forlogin ul.descening li input { float:left; }
		#addIndustry  { margin-top:20px;  margin-bottom:100px; }
		#toolbar { width:120px; } 
		.fixed-table-toolbar { width:120px; }
		.industrySetting { width:100%; overflow:hidden; margin-top:20px; margin-bottom:0; }
		.industrySetting li { float:left; }
		.search-box { overflow:hidden; padding-bottom:3px; }
		.search-box  .fixed-table-toolbar { float:left; }
		.search-box  #toolbar {margin-left:20px; float:left; margin-top:10px; margin-bottom:10px; }
		.bootstrap-table { margin-top:15px; }
		
		
		@media (min-width: 100px) {
			.container {
				width: auto;
			}
		}
		.fixed-table-toolbar { width:100%; }
		
		.pull-right1.search { margin-top:0; float:left; width:317px; }
		.pull-right1 { float:left; }
		.pull-right1.select { width:auto; }
		.search-box { margin-top:10px; }
		
		.data-box {
			width: 471px;
			height: 30px;
			border-radius: 6px;
			border: 1px solid #e8e8e8;
			padding-bottom: 0;
			position: relative;
			float:left; 
			margin-top:2px;
		}
		
		.data-box input {
			color: #a7a7a7;
			width: 228px;
			border: none;
			text-align: center;
			line-height: 28px;
		}
		
		.search-btn { margin-left:20px; }
		th,td { text-align:center; }
		
		
		
		
		
		
		
		
		.modal-dialog { width:860px; }
.modal-body-title { border-bottom:1px solid #e5e5e5; padding-bottom:15px;  }
ul li { list-style:none; }
.main-title-box { overflow:hidden; }
.main-title { width:10px; height:20px; background:rgba(255, 153, 0, 1); display:block; float:left; }
.main-box { margin-top:20px; overflow:hidden;  }
.main-txt { margin-left:10px; }
.main-list-item { float:left; width:650px; }
.main-list-item li { line-height:34px; display:table; margin-top:15px;  }
.main-list-item li span:nth-child(1){ display:block; float:left; font-weight:700; font-family: 'Arial Negreta', 'Arial'; width:100px;
 text-align:right; margin-right:20px;  }
.btn-primary { background:#5cb85c; border-color:#4cae4c; }

.conpanyname { float:left; }

.main-list-item.conpany { margin-bottom:20px; }
#addIndustry .btn-default { margin-left:20px; }

.modal-dialog { width:950px; }

.main-list-item .radio { float:left; } 
.main-list-item .radio  i { font-style:normal;}
.main-list-item .radio  input { margin-top:10px; }
.achivement-list  { display:table; width:210px }
.achivement-list>span { width:100%; display:table; margin-bottom:10px; }
.achivement-list ul { float:left; }
.achivement-list ul li { border:1px solid #e5e5e5; width:98px; text-align:center; line-height:30px; }
.achivement-list ul li { border-bottom:none; }
.achivement-list ul li:last-child { border-bottom:1px solid #e5e5e5;}
.achivement-list ul li:first-child { background:#f6f6f6; }



#myModaltwo { background:rgba(0,0,0,0.8);  }
#myModaltwo .main-list-item { width:auto; float:none; margin:50px auto; display:table; }
#myModaltwo .main-list-item li span:nth-child(1) { width:auto;   }
#myModaltwo .main-box { margin-top:0px; }
#myModaltwo .main-list-item li:nth-child(1) { margin-top:0px;   }
@media (min-width: 768px){
	#myModaltwo  .modal-dialog {
		width: 600px;
		margin: 250px auto;
	}
}
 .btn-success.btn-lg { padding:6px 12px; }
 .btn-lg, .btn-group-lg>.btn { font-size:14px; }
 
 
 .form_date.start_date {
    display: block;
    width: 100%;
    height: 34px;
    padding: 6px 12px;
    font-size: 14px;
    line-height: 1.42857143;
    color: #555;
    background-color: #fff;
    background-image: none;
    border: 1px solid #ccc;
    border-radius: 4px;
    -webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    box-shadow: inset 0 1px 1px rgba(0,0,0,.075);
    -webkit-transition: border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;
    -o-transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
    transition: border-color ease-in-out .15s,box-shadow ease-in-out .15s;
}

  .bootstrap-table .fixed-table-toolbar {  overflow:-hidden; }
.pull-right.search { display:none; height:auto;}

.bootstrap-table { margin-top:-30px; }
label.error { color:red; font-weight:normal; margin-left:20px;  display:none;}

.orderassignstate { width:460px; float:left; }
.orderassignstate  li { float:left; width:auto; margin-top:0; }
.orderassignstate  li.hasorder { width:100px; }
.orderassignstate  li i { font-style:normal; }

	</style>
</head>
<body>
    <div class="container">
		<div class="search-box">
			<div class="fixed-table-toolbar">
				<div class="pull-right1 search">
					<input class="form-control" type="text" placeholder="Search">
				</div>
				
				
				<!--
				<div class="pull-right1 select">
					<select style="width:auto;" class="form-control assignStatee">
						<option value="1">选择指派结果</option>
					</select>
				</div>
				
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">all</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
				<div class="pull-right1 select">
					<select class="form-control">
						<option value="">all</option>
						<option value="">open</option>
						<option value="all">close</option>
					</select>
				</div>
			
				<div class="data-box">
						<input autoComplete="off" placeholder="开始日期" type="text" class=" start_date" readOnly /><i class="date_icon"></i><span>~</span>
						<input autoComplete="off" placeholder="结束日期" type="text" class=" end_date" readOnly /><i class="date_icon"></i>
						<p class="error time">请填写开始日期</p><p class="error time">请填写结束日期</p>
				</div>
					-->
				<div class="pull-right1 select search-btn">
					<button type="button" class="btn btn-success">搜索</button>
				</div>
			</div>
		</div>
        <table id="table">
            
        </table>
   
	
	
	<div id="forlogin">
		 <div>
			<ul class="industry">
				<li class="first" >行业名称:</li>
				<li class="last"><input id="username" placeholder="请输入行业名称"/></li>
			</ul>
			<ul class="high">
				<li  class="first" >分类级别:</li>
				<li class="high-n last">一级分类</li>
			</ul>
			<ul>
				<li  class="first" >状态:</li>
				<li class="last">
					<div class="running"><input type="radio" /><span>启用</span></div>
					<div class="outOff"><input type="radio" /><span>停用</span></div>
				</li>
			</ul>
			<ul class="descening">
				<li  class="first" >排序值</li>
				<li class="last"><input placeholder="请输入排序值，值越大越靠前"/></li>
			</ul>
		 </div>
	</div>
	
	
	 <div id="addIndustry">
		<button   class="btn btn-primary  btn-success addAssign btn-lg">新增指派</button>
		<button  class="btn btn-default returnpage">返回</button>
	 </div>
	</div>
	
	
	
	
	<!--弹出成-->
	
		<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					订单指派
				</h4>
			</div>
			<div class="modal-body">
				
				<div class="main-box">
					
					<ul class="main-list-item">
						<li>
							<span>选择接包方：</span>
							<div class="pull-right1 select">
								<select class="form-control meetinguser">
									<option value="">请选择接包方</option>
									
								</select>
							</div>
							<label id="unitprice-error" class="error" for="unitprice">请选择接包方用户！</label>
						</li>
						<li>
							<span>开始日期：</span>
							<div class="pull-right1 select">
								<input  placeholder="开始日期" type="text" class="form_date start_date" readonly />
							</div>
						</li>
						<li>
							<span>结束日期：</span>
							<span class="endtime"></span>
						</li>
						<li>
							<span>目标区域：</span>
							<span class="targetarea"></span>
						</li>
						<li>
							<span>指派订单数量：</span>
							<div class="pull-right1 select">
								<input style="float:left;" class="orderquantity" type="number" />
								<span style="margin-left:10px;float:left;" >条</span>
								
							</div>
							<label id="orderquantity-error" class="error" for="orderquantity">请选填写条数！</label>
						</li>
						<li style="width:100%;">
							<div style="float:left;">
								<span>订单情况：</span>
								<ol class="orderassignstate">
									<li>已累计指派订单：</li>
									<li class="hasorder">
										<i class="assignquantity"></i>
										<i>条</i>
									</li>
									<li>已领取订单：</li>
									<li class="hasorder">
										<i class="receivedquantity"></i>
										<i>条</i>
									</li>
									<li>待领取订单：</li>
									<li class="hasorder">
										<i class="tobereceivedquantity"></i>
										<i>条</i>
									</li>
									<li>已放弃订单：</li>
									<li class="hasorder">
										<i class="abandonedquantity"></i>
										<i>条</i>
									</li>
								</ol>
								
								<!--
									tobereceivedquantity 待领取
									
									receivedquantity 已领取
									
									abandonedquantity 已放弃
								
								-->
							</div>
						</li>
						<li>
							<span>订单服务费：</span>
							<span class="ordersfree">0</span>
						</li>
						<li>
							<span>指派订单单价：</span>
							<span  class="unitprice"></span>
							<span>元</span>
						</li>
						<li>
							<span>精准信息服务：</span>
							<div class="radio useinfoservice">
							  <label>
								<input type="radio"  name="optionsRadios" id="optionsRadios1" value="option1" />
								<i>不使用</i>
							  </label>
							  <br />
							  <label>
								<input type="radio" name="optionsRadios" id="optionsRadios1" value="option1" >
								<i>MSO平台，按结算金额8%收费</i>
							  </label>
							</div>
							<label id="useinfoservice-error" style="margin-top:45px;" class="error" for="useinfoservice">请选择精准信息服务！</label>
						</li>
					</ul>
					<div class="achivement-list">
				
			
					</div>
	
					<!--
					<ul class="main-list-item">
						<li>
							<span>需求名：</span>
							<span>e-darrn-100</span>
						</li>
						<li>
							<span>需求量</span>
							<span>1000</span>
						</li>
					</ul>
					-->
				</div>
				
				<!--<div class="modal-body-title"></div>-->	
				<div class="main-box">
				<!--
					<div class="main-title-box"><span class="main-title"></span><span class="main-txt">任务附件</span><div>
					<ul class="main-list-item conpany">
						<li>
							<span class="conpanyname">发包方公司名：</span>
							
							<div class="pull-right1 select">
									<select class="form-control">
										<option value="">all</option>
										<option value="">open</option>
										<option value="all">close</option>
									</select>
							</div>
						</li>
					</ul>
				-->	
					
					
					<!--
					<ul class="main-list-item">
						<li>
							<span>需求名：</span>
							<span>e-darrn-100</span>
						</li>
						<li>
							<span>需求量</span>
							<span>1000</span>
						</li>
					</ul>
					-->
				</div>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary confirm  btn-default" >
					确认指派
				</button>
				<button type="button"  data-dismiss="modal"  class="btn">
					取消
		</button>
		</div><!-- /.modal-content -->
		
		
	</div><!-- /.modal-dialog -->
	
	</div>
</div>














	<!--弹出层-第二层-->
		<div class="modal fade" id="myModaltwo" tabindex="10" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×
				</button>
				<h4 class="modal-title" id="myModalLabel">
					确认指派
				</h4>
			</div>
			<div class="modal-body">
				
				<div class="main-box">
					
					<ul class="main-list-item">
						<li>
							<span>确认指派订单嘛？</span>
						</li>
						<li>
							<span>订单名称</span>
							<span class="taskname"></span>
						</li>
						<li>
							<span>接包方</span>
							<span class="meetingname"></span>
						</li>
						<li>
							<span>指派数量</span>
							<span class="assigncount"></span>
						</li>
				
					</ul>

			
				</div>
		
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary determine btn-default" >
					确认指派
				</button>
				<button type="button"  data-dismiss="modal"  class="btn">
					取消
		</button>
		</div><!-- /.modal-content -->
		
		
	</div><!-- /.modal-dialog -->
	
	</div>
</div>

<script>
/*新增行业*/

var $table = $('#table');
	//debugger;
	//文档地址http://bootstrap-table.wenzhixin.net.cn/zh-cn/documentation/
/*自定义头部*/


//pasf/csusers/{csuserid}/tasks/{taskid}/orders 
var datatask = JSON.parse($.decode($.sessionStorage('taskseconddata')));
//debugger;
var url = domain137 + '/csusers/'+roleid+'/tasks/'+datatask.taskid+'/orders';


$('#table').bootstrapTable({
	 url:url,
	 pagination: true, //分页
	 contentType:'application/json',
     search:true,
	 showColumns:true,
	 checkbox:false,
	 queryParams:function (params){
			 /*自定义参数,如果有参数在这里定义*/
		
		 ifAll = $('.assignStatee').val();
		 // console.log(ifAll);
		 if(!(ifAll == 1 || ifAll ==0)){
			 //var selectedtext = $('.assignStatee').find("option:selected").text();
			 ifAll = 0;
		 }

		 var data = {all:ifAll};
		 data.size = 100000000;
			  
	   return  data;
	 },
	 //sidePagination: "server",
	 sidePagination: "client",
	 pageSize:5,
	 responseHandler:function(res){

	 /*sidePagination server pageSize需要设置再请求参数 queryParams server 用rows*/
	 /*sidePagination client pageSize需要设置再请求参数 直接设置 client 用data */
	 
		var newJson = {};
		newJson.total = '800';
		//newJson.rows = res.list;
		newJson.data = res.data;
		//debugger;
		return newJson;
     },
	 onLoadSuccess(){
		/*移动自带事件*/
		$('.search-btn button').click(function(){
			//debugger;
			$('.search input').eq(1).val($('.search input').eq(0).val());
			$('.search input').eq(1).keyup();
		});
		//debugger;

		
		/*当search 没有vlaue的时候*/
		$('.search input').eq(0)[0].oninput= function (){
			if(!this.value){
				$('.search input').eq(1).val(this.value);
				$('.search input').eq(1).keyup();
			}
		};
		
		
		$('.search input').eq(0).keyup(function (ev){
			
			var oEvent = ev || event;
			if(oEvent.keyCode==13){
				$('.search input').eq(1).val(this.value);
				$('.search input').eq(1).keyup();
			}
		});
	 },
	 formatNoMatches:function(){
         return '没有搜索结果'
     },
     formatLoadingMessage:function(){
          return '正在努力加载中...';
     },

	 columns: [{  
          field: 'username',  
          title: '接包方用户名'  
        }, {  
          field: 'companyname',  
          title: '接包方公司'  
        }, {  
          field: 'shortname',  
          title: '内部简称'  
        }, {  
          field: 'uniquename',  
          title: '订单名称'  
        }, {  
          field: 'orderquantity',  
          title: '订单数量'  
        }, 
		{  
          field: 'unitprice',  
          title: '订单单价'  
        }, 
		 {  
          field: 'totalprice',  
          title: '订单金额'  
        }, 
		 {  
          field: 'orderstatedesc',  
          title: '指派结果'  
        }, 
		 {  
          field: 'createtime',  
          title: '指派时间'  
        }]  
		
});

/*orderquantity*/

$(document).on('blur','.orderquantity',function (ev){
	var target = ev.currentTarget;
	if(!target.value){
		if(datatask.servicetype != 2){
			$('.ordersfree').html(0);
		}
	}else{
		if(datatask.servicetype != 2){
			$('.ordersfree').html(parseInt(target.value));
		}
	}
	//分配的条数
	if($('.orderquantity').val() && ($('.orderquantity').val()>=1)){
		$('#orderquantity-error').hide();
	}else{
		$('#orderquantity-error').show();
	}
	
});

/*新增指派*/


$('.meetinguser').change(function (){
	if(this.value){
		$('#unitprice-error').hide();
	}else{
		$('#unitprice-error').show();
	}
	
});

$('.addAssign').click(function (){
	 /*获取list详情 和 修改 list详情*/
	 
	 $('.meetinguser').val('');
	 $('.start_date').val('');
	 $('.orderquantity').val('');
	 $('.ordersfree').html('0');
	 $('.useinfoservice input').prop('checked',false);
	
	getdetialdata(datatask.taskid);
	$('label.error').hide();
	$('#myModal').modal('show');
	getmeetinguserlist();
	
});


$('.confirm').click(function (){
	//没有选择接包方用户
	if($('.meetinguser').val()){
		$('#unitprice-error').hide();
	}else{
		$('#unitprice-error').show();
	}
	
	
	//分配的条数
	if($('.orderquantity').val() && ($('.orderquantity').val()>=1)){
		$('#orderquantity-error').hide();
	}else{
		$('#orderquantity-error').show();
	}
	
	/*精准信息服务*/
	//$('.useinfoservice input[type="radio"]').get(1).checked?1:0
	var useinfoserviceEle = $('.useinfoservice input[type="radio"]');
	if(!useinfoserviceEle.get(1).checked && !useinfoserviceEle.get(0).checked){
		$('#useinfoservice-error').show();
	}else{
		$('#useinfoservice-error').hide();
	}
	
	//orderquantity
	if($('label.error:visible').get(0)){
		return;
	}
	$('#myModaltwo').modal('show');
	//$('.ordername').html('ordername');
	$('.meetingname').html($('.meetinguser').find('option:selected').text());
	$('.assigncount').html(parseInt($('.orderquantity').val())+'条');
});


$('.returnpage').click(function (){
	history.go(-1);
});
	
	

function getmeetinguserlist(){
	////pt/workers/接包方用户列表
	var url  = domain137 + '/pt/workers';
	
	$.when($.ajax({
		url:url,
		dataType:'json',
	})).then(function (data){
		//debugger;
		if(data.msg=="success"){
			if(data.data){
				data.data.map(function (data,index){
					$('.meetinguser').append('<option value="'+data.workerid+'">'+data.shortname+'</option>');
				});
			}
		}
		
	}).fail(function (data){
		//$('#loading').modal('hide');
		//debugger;
	});
}

function getdetialdata(taskid){

	if(!taskid)return;
	////GET 开发完成 /pasf/pt/tasks/{taskid}
	var url = domain137 + '/pt/tasks/'+taskid
	
	$.when($.ajax({
		url:url,
		dataType:'json',
	})).then(function (data){
		//debugger;
		if(data.msg=="success"){
			/*关闭加载层*/
			$('#loading').modal('hide');
			handleDetail(data.data);
		}
		
	}).fail(function (data){
		//$('#loading').modal('hide');
		//debugger;
	});
}


	function handleDetail(data){
		for(var name in data){
			if(name=='targetarea' && (datatask.servicetype == 2)){
				$('.'+ name).parent().remove();
				$('.ordersfree').html('免订单服务费');
			}else{
				$('.'+ name).html(data[name]);
			}
		}
		//debugger;
		$('.taskname').html(data.taskname);
		
		$(".start_date")
			 .datetimepicker({
				language:  'zh-CN',
				 weekStart: 1,
				 todayBtn:  0,
				 autoclose: 1,
				 todayHighlight: 0,
				 startView: 2,
				 minView: 2,
				 forceParse: 0,
				 format: 'yyyy-mm-dd',
				 endDate:new Date(data.endtime),
		});
	}


/*更新list详情*/
$('.determine').click(function (){
	//POST 开发完成 /pasf/csusers/{csuserid}/tasks/{taskid}/orders
	/*patch*/
	var jfuid = $(this).attr('data-jfuid');
	var url = domain137 + '/csusers/'+roleid+'/tasks/'+datatask.taskid+'/orders';
	$.when($.ajax({
		url:url,
		type:'POST',
		contentType:'application/json',
		data:JSON.stringify(
			{
			  "taskid":datatask.taskid,
			  "workeruserid":$('.meetinguser').val(),
			  "begintime":$('.form_date.start_date').val(),
			  "targetarea":$('.targetarea').html(),
			  "orderquantity":$('.orderquantity').val(),
			  "useinfoservice": $('.useinfoservice input[type="radio"]').get(1).checked?1:0,
		}
		),
	})).then(function (data){
		if(data.msg == "success"){
			$('#myModaltwo').modal('hide');
			$('#myModal').modal('hide');
			$('#table').bootstrapTable('refresh');
		}
		
	}).fail(function (data){
	
	});
});


//debugger;




/*创建地区*/
if(datatask.servicetype != 2){
	createachivementlist({ele:'.achivement-list',demandid:datatask.demandid,publics:'releasequantity'});
}


	
</script>

</body>
</html>